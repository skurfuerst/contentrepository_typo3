services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  Sandstorm\ContentrepositoryTypo3\:
    resource: '../Classes/*'

  # Factory dependencies
  Sandstorm\ContentrepositoryTypo3\Registry\SubgraphCachingInMemory\FlushSubgraphCachePoolCatchUpHookFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\Clock\SystemClockFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\EventStore\DoctrineEventStoreFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\NodeTypeManager\DefaultNodeTypeManagerFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\ContentDimensionSource\ConfigurationBasedContentDimensionSourceFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\AuthProvider\StaticAuthProviderFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\SubscriptionStore\SubscriptionStoreFactory:
    public: true
  Sandstorm\ContentrepositoryTypo3\Registry\Factory\ContentGraphProjectionFactoryAdapter:
    public: true

  TYPO3\CMS\Backend\Tree\Repository\PageTreeRepository:
    alias: Sandstorm\ContentrepositoryTypo3\Integration\Feature\PageTreeDisplay\PageTreeRepository
    public: true

  Sandstorm\ContentrepositoryTypo3\Integration\Feature\PageTreeDisplay\PageTreeRepository:
    public: true

  TYPO3\CMS\Backend\Controller\PageLayoutController:
    alias: Sandstorm\ContentrepositoryTypo3\Integration\Feature\BackendPageLayout\PageLayoutControllerPatched
    public: true
  Sandstorm\ContentrepositoryTypo3\Integration\Feature\BackendPageLayout\PageLayoutControllerPatched:
    public: true


  Sandstorm\ContentrepositoryTypo3\Integration\Feature\DataHandler\ProcessDatamapHook:
    public: true

  # CLI commands
  Sandstorm\ContentrepositoryTypo3\Registry\Command\CrSetupCommand:
    tags:
      - name: 'console.command'
        command: 'cr:setup'
        description: 'Create content repository tables'
        schedulable: false

  Sandstorm\ContentrepositoryTypo3\Registry\Command\CrStatusCommand:
    tags:
      - name: 'console.command'
        command: 'cr:status'
        description: 'Content Repository Status'
        schedulable: false

  Sandstorm\ContentrepositoryTypo3\Integration\Feature\RootNode\Command\SetupRootNodeCommand:
    tags:
      - name: 'console.command'
        command: 'cr:setupRootNode'
        description: 'Setup root Node'
        schedulable: false
